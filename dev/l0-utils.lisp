(in-package metatilities)

;;; ----------------------------------------------------------------------------
;;;
;;;   EXPORTS
;;;

(export 
 '(form-symbol-in-package
   form-symbol
   form-keyword
   form-uninterned-symbol
   
   current-load-file
   with-unique-names
   
   ensure-list 
   newsym
   export-exported-symbols

   length-at-most-p
   length-at-least-p
   length-1-list-p
   
   nearly-zero-p
   nearly-equal-p

   +whitespace-characters+
   whitespacep))


;;; ----------------------------------------------------------------------------
;;;
;;;   MACROS
;;;

(eval-when (:compile-toplevel :load-toplevel :execute)
  
  ;;; NOTE: can't use WITH-UNIQUE-NAMES here
  ;;; XXX This is a lousy name.  Don't export.
  (defmacro with-standard-printing (&body forms &aux (package (gensym "PACKAGE")))
    "Similar to WITH-STANDARD-IO-SYNTAX, but doesn't change packages."
    `(let ((,package *package*))
       (with-standard-io-syntax
         (let ((*package* ,package))
           ,@forms))))
  
  ) ; eval-when


;;; ----------------------------------------------------------------------------
;;;
;;;   PREDICATES
;;;

#-(or DIGITOOL OPENMCL)
(defun neq (left right)
  (not (eq left right)))

#-(or DIGITOOL OPENMCL)
(declaim (inline neq))

#-(or DIGITOOL OPENMCL)
(define-compiler-macro neq (left right)
  `(not (eq ,left ,right)))

;;; ----------------------------------------------------------------------------
;;;
;;;   FORMING SYMBOLS
;;;

(eval-when (:compile-toplevel :load-toplevel :execute)
  
  (defun form-symbol-in-package (package &rest names)
    (with-standard-printing
      (intern (format nil "狺钺礤螬疳汶徵濠┅ㄤ彐躅骘蝽簌礅镬é蝈篝钺礤螬鏖翳篝犷溽蜾痱轭糸铉ㄡ痧禊＇骘蝽簌礅镬轭疳汶徵疳汶徵濯钺礤螬┅ㄤ彐躅骘蝽脲黠蜾é蝈篝钺礤螬鏖翳篝犷溽蜾痱轭糸铉ㄡ痧禊＇骘蝽簌礅镬轭疳汶徵ㄦ轭洵疳汶徵弘妁黠蜾钺礤螬┅ㄤ彐躅骘蝽躅轭翦蝾邃簌礅镬é蝈篝钺礤螬鏖翳篝犷溽蜾痱轭糸铉磲脲簌礅镬ㄦ矧磲铋狺钺礤螬┅弼犰麒孱换ㄤ彐躅沲蝌孱舡祜徜骈戾ī⒁弭躜铙ㄩ痫篌殁戾翳鲠祯镦翳骈戾沲蝌孱綮忮轭祜徜邃矧骝镯麒殂泔溴轶沲蝌孱綮忮轭弼犰踽翦洚＋犰戾珧屮沆邯箫躜沐疳翳钺礤＋拈玳麸镬ㄩ祜徜疳翳钺礤祜徜疳翳钺礤换澡轶磲脲轸黠螂轭骝邃怩骀弪沣旌祜徜轭绛骈戾箫躜沐骈戾－矧祯汩犰戾珧清铄蜥砒痨矧弪兔泰祜徜疳翳钺礤换ㄤ彐磲泸鏖翳躅轳蹂钺礤è蝈篝鲠蝮怙澌怙澌⒙轭潴翳簌礅镬轭至矣麸珏铙眢沔鏖翳珏铙眢ㄡ篌弪ㄥ鲥蝙＇簌礅镬鲠蝮ī⒚犷蝈忾钿犷屮痱弩箝镱啜戾磲疸狎＇灬礅溽啜ㄧ孱簌愍К┅鲠蝮棱镤┅换ㄤ彐躅孱篚蝈扉篝ㄩ扉篝扉篝┅换换铄黧换换语礤糸礤轸铋沐麸栳鲥秕珏铙眢礤犷箫礤翳轭麒孱换秕蝈蝈徜轭翳磲泸镥疳铙轱镦箫礤骘蝽澡痱镡戾换轶翳狒殒秕玳鲥痱彐轼麸桥斡偻轸蝈磲轭翳痱彐轼换躅糸秕汨犷珏轸换ㄥ鲠飙麒孱＋锰蕴ê泔眇殪瀛麸痨弼屐红镝洵麸痨弼屐哄邈豸濠－锰蕴ㄣ镯痖戾祜徜弼犰换翳弼犰麒孱轶忮汜躞翳铄黧骢钽糸镱轶躞邃轭屮疳钿轭换圜轸璀鲠蜷徕戾螫犷雉桢磲泸矬忮祜鳟ㄤ彐鲠铄黧憝泔躅翦颡⒚秕铘弪躞邃怡闻子偻骘珏铄蜥糸铉痱轭钺礤螽ㄤ彐躅铄黧é镳糸镱犰痱彐轼⒇┅⒚蝈狒铄躅轭翦蝾邃簌礅镬麒矬痱轭钺礤忮玳铙鏖翳囵蝈骈К麒殂磲忮篝蜷铉矧簌礅镬澡轶溟骀弪骝镯噻孱簌恣轭翳狒翳痱彐轼轶铒篝殂膣躅戾篌篝蜷铉痱彐轼箦翩痱彐轼篝蜷铉痱彐轼┅磲脲簌礅镬ㄦ矧磲铋狺船О洧痱彐轼ㄩ钽铄黧憝泔躅翦颡┅┅换ㄤ彐躅屮痫螋屮痫螋邃簌礅镬ㄦ蝻憝疳汶徵麸疳汶徵濠⑼犭翳屮痫螋邃簌礅镬轭骝镯疳汶徵忮犰箫屮痫螋邃骝镯麸疳汶徵瀹躞瀛疳汶徵骝镯疳汶徵麸疳汶徵濠ㄤ锃屮翦蝾犰簌礅镬簌ㄦ轭洵疳汶徵骝镯疳汶徵濠ㄥ痫螋簌麸疳汶徵濠┅换ㄤ彐珏铄蜷戾铉翳狒戾狍舡翳轭戾铉翳ê滹沲礤铘狒轱⒁弭躜铙趄蹂殒翳轭栳铒驽麇翳犷戾铉翳屐屙孱趔轭轸┅换ㄤ彐礤翳镤戾铉翳狒戾狍舡è翳轭箦聃孱沐戾铉翳窘戾铉翳翳轭绌戾铉翳┅换ㄤ彐礤翳镤戾铉翳狒戾狍舡è翳轭泔铙戾铉翳戾è翦眇翳轭绌祜镳蝈疱狒ū戾铉翳麒殪翦眇滹箦翩翦眇蝈篝翦眇┅铒铛祆翦眇┅┅换ㄤ彐珏铄蜷戾铉翳狒盹篝翳轭戾铉翳ê滹沲礤铘狒轱⒁弭躜铙趄蹂殒翳轭栳铒盹蝈翳犷戾铉翳屐屙孱趔轭轸┅换ㄤ彐礤翳镤戾铉翳狒盹篝è翳轭箦聃孱沐戾铉翳冀戾铉翳翳轭绌戾铉翳┅换ㄤ彐礤翳镤戾铉翳狒盹篝è翳轭泔铙戾铉翳换靠沔戾铉翳狒戾狍舡瓞翳轶箦屙箝黹灬戾è翦眇翳轭绌祜镳蝈疱狒戾铉翳麒殪翦眇滹箦翩翦眇蝈篝翦眇┅铛祆翦眇┅换换王汨忮趑弪翳犷滹轭戾铉翳暴ㄤ邈灬轫ㄩ铎轭戾铉翳杯扉篝皓ㄤ彐躅戾铉翳杯扉篝⑸扉篝镦戾铉翳笨ㄡ钿ㄣ镱箴铛祆ㄣ潋┅┅换ㄤ彐躅铄狎禊弪锃镳糸镱犰翳蝈箬镬爱鞍氨┅ㄤ邈灬蝈镳糸黹箴邋畅箴徙畅ㄤ邂蹒癌筢驽豉癌ㄤ钺黹悱屮翦铘翳蝈箬镬洎换谅泔铙弩ㄩ爱翳蝈箬镬翳蝈箬镬洎┅＋藻篝糸礤轸ê蝈痫螋舂祜镳蝈疱狒卑鞍鞍滹铄狎禊弪锃卑暴铄狎禊弪锃爱鞍鞍暴铄狎禊弪锃爱鞍鞍暴┅换ㄤ彐躅铄狎禊羼踽飙翳蝈箬镬洎ㄤ邈灬蝈镳糸黹箴邋畅箴徙畅ㄤ邂蹒癌筢驽豉癌ㄤ钺黹悱屮翦铘翳蝈箬镬洎豉疱滹踱戾骒镝翳蝈箬镬洎戾è翦眇爱颁癌ㄤ邈灬蝈豉疱滹踱戾骒镝翦眇ㄤ钺黹悱屮翦铘翦眇┅ㄣ镱è箦翩翦眇翳滹踱戾骒镝ō┅翦眇翳蝈箬镬洎箦翩翦眇翳滹踱戾骒镝ō┅翦眇翳蝈箬镬洎┅┅＋藻篝糸礤轸ê蝈痫螋舂祜镳蝈疱狒卑鞍鞍滹铄狎禊羼踽飙卑卑爱鞍氨铄狎禊羼踽飙卑渤床炒卑渤床炒爱鞍氨┅换换麒轸弩疳沐换ㄤ彐疳蜥礤翦麒轸弩疳沐汨狎徙翦蝮扉篝＼羽徙＼五黛轭＼葬＼嗅珏＼熙祆＼涕铄驽邃┅换ㄤ彐躅麒轸弩疳沐ㄣ栳颟ㄦ轭汨狎麒轸弩疳沐汨狎徙翦蝮呼弩＇汨狎僵